\documentclass{article}
\usepackage{ctex}
\usepackage[a4paper,left=10mm,right=10mm,top=15mm,bottom=15mm]{geometry}
\usepackage{graphicx}
\usepackage{amsfonts,amssymb}
\usepackage{amsmath}
\usepackage{biblatex}
\usepackage{hyperref}
\usepackage{color}
\usepackage{titlesec}
\usepackage{titletoc}

\title{VI-SLAM系统初始化闭式可解性分析}
\author{张谦}
\date{\today}
\begin{document}
\maketitle
\tableofcontents
\newpage

\section{系统模型}
由VI-SLAM系统可观性分析可知，在给定视觉和IMU观测后，body系的全局平移和重力方向旋转yaw角不可观，
body系的速度、重力和绝对尺度是可观的。分析VI-SLAM系统初始化时的闭式可解性，亦即分析在一段时间内，
在不同条件下可观变量的可解性：（1）运动轨迹和状态；（2）地图点数量和观测图像上的分布；（3）相机图像帧数。

\subsection{几何关系}
为简化分析，不考虑相机和IMU之间的外参，即假设相机和IMU位姿重合。在该系统中，四元数表示旋转采用Hamilton形式。坐标系约定：全局坐标系用$G$表示，Camera坐标系用$C$表示，
IMU坐标系用$I$表示，地图点用$f$表示；相机、IMU和地图点表示在某个坐标系下，则该坐标系符号写在对应变量符号的左上角，
变量标识写在变量符号的右下角，例如$\sideset{^G}{}{\mathop{\mathbf{p}_{I}}}$表示IMU系（body系）原点在全局坐标系中的位置（平移），
$\sideset{^G}{}{\mathop{\textbf{v}_{I}}}$表示IMU系在全局坐标系下的速度，$\sideset{^G}{}{\mathop{\textbf{q}_{I}}}$表示从全局坐标系
旋转到IMU系的单位四元数，由于采用Hamilton形式，旋转均是由$I$系到$G$系旋转，与JPL表示方式相反；$\sideset{^G}{}{\mathop{\textbf{p}_{f_i}}}$
表示第$i$个地图点在$G$系下的坐标。
\begin{figure}[ht]
    \centering
    \includegraphics[width=15cm]{figure1.png}
    \caption{几何关系}
    \label{figs:geometryRelation}
\end{figure}

\par
陀螺仪测量$\sideset{^I}{}{\mathop{\mathbf{\omega}_m}}$和加速度计测量$\sideset{^I}{}{\mathop{\mathbf{a}_m}}$模型为：
\begin{equation}
    \sideset{^I}{}{\mathop{\mathbf{\omega}_{m}(t)}}=\sideset{^I}{}{\mathop{\mathbf{\omega}(t)}}
    +\textbf{b}_{g}(t)+\textbf{n}_{g}(t)
\end{equation}
\begin{equation}
    \sideset{^I}{}{\mathop{\mathbf{a}_{m}(t)}}=\textbf{C}^T(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(t)}})
    (\sideset{^G}{}{\mathop{\mathbf{a}_{I}(t)}}-\sideset{^G}{}{\mathop{\mathbf{g}}})
    +\textbf{b}_{a}(t)+\textbf{n}_{a}(t)
\end{equation}
其中$\textbf{C}(\mathbf{q})$表示四元数对应的旋转矩阵。在分析可解性时，若不考虑噪声影响，则有，
\begin{equation}
    \sideset{^I}{}{\mathop{\mathbf{\omega}_{m}(t)}}=\sideset{^I}{}{\mathop{\mathbf{\omega}(t)}}
    +\textbf{b}_{g}(t)
\end{equation}
\begin{equation}
    \sideset{^G}{}{\mathop{\mathbf{a}_{I}(t)}}=\textbf{C}(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(t)}})
    (\sideset{^I}{}{\mathop{\mathbf{a}_{m}(t)}}-\textbf{b}_{a}(t))
    +\sideset{^G}{}{\mathop{\mathbf{g}}}
\end{equation}

\par
现分析时间段$\left[t_{in},t_{fin}\right]$内的可解性，如图\ref{figs:geometryRelation}所示，
从$t_{in}$到$t\in\left[t_{in},t_{fin}\right]$时刻的平移几何关系可表示为，
\begin{equation}
    \begin{array}{ll}
        \sideset{^G}{}{\mathop{\textbf{p}_{I}}}(t)&=\sideset{^G}{}{\mathop{\textbf{p}_{I}}}(t_{in})+
        \sideset{^G}{}{\mathop{\textbf{v}_{I}}}(t_{in})\Delta{t}+\iint_{t_{in}}^{t}\sideset{^G}{}{\mathop{\mathbf{a}_{I}(\tau)}}d{\tau}^2\\
        &=\sideset{^G}{}{\mathop{\textbf{p}_{I}}}(t_{in})+
        \sideset{^G}{}{\mathop{\textbf{v}_{I}}}(t_{in})\Delta{t}+\iint_{t_{in}}^{t}
        (\textbf{C}(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(\tau)}})(
        \sideset{^I}{}{\mathop{\mathbf{a}_{m}(\tau)}}-\textbf{b}_{a}(\tau))
        +\sideset{^G}{}{\mathop{\mathbf{g}}})d{\tau}^2\\
        &=\sideset{^G}{}{\mathop{\textbf{p}_{I}}}(t_{in})+
        \sideset{^G}{}{\mathop{\textbf{v}_{I}}}(t_{in})\Delta{t}
        +\frac{1}{2}\sideset{^G}{}{\mathop{\mathbf{g}}}\Delta{t}^{2}
        +\iint_{t_{in}}^{t}\textbf{C}(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(\tau)}})
        (\sideset{^I}{}{\mathop{\mathbf{a}_{m}(\tau)}}-\textbf{b}_{a}(\tau))d{\tau}^2\\
        &=\sideset{^G}{}{\mathop{\textbf{p}_{I}}}(t_{in})+
        \sideset{^G}{}{\mathop{\textbf{v}_{I}}}(t_{in})\Delta{t}
        +\frac{1}{2}\sideset{^G}{}{\mathop{\mathbf{g}}}\Delta{t}^{2}
        +\textbf{C}(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(t_{in})}})\textbf{C}^T(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(t_{in})}})
        \iint_{t_{in}}^{t}\textbf{C}(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(\tau)}})
        (\sideset{^I}{}{\mathop{\mathbf{a}_{m}(\tau)}}-\textbf{b}_{a}(\tau))d{\tau}^2\\
        &=\sideset{^G}{}{\mathop{\textbf{p}_{I}}}(t_{in})+
        \sideset{^G}{}{\mathop{\textbf{v}_{I}}}(t_{in})\Delta{t}
        +\frac{1}{2}\sideset{^G}{}{\mathop{\mathbf{g}}}\Delta{t}^{2}
        +\textbf{C}(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(t_{in})}})
        \iint_{t_{in}}^{t}\textbf{C}^T(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(t_{in})}})\textbf{C}(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(\tau)}})
        (\sideset{^I}{}{\mathop{\mathbf{a}_{m}(\tau)}}-\textbf{b}_{a}(\tau))d{\tau}^2\\
        &=\sideset{^G}{}{\mathop{\textbf{p}_{I}}}(t_{in})+
        \sideset{^G}{}{\mathop{\textbf{v}_{I}}}(t_{in})\Delta{t}
        +\frac{1}{2}\sideset{^G}{}{\mathop{\mathbf{g}}}\Delta{t}^{2}
        +\textbf{C}(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(t_{in})}})
        \iint_{t_{in}}^{t}\textbf{C}(\sideset{^{I_{in}}}{}{\mathop{\mathbf{q}_{I}(\tau)}})
        (\sideset{^I}{}{\mathop{\mathbf{a}_{m}(\tau)}}-\textbf{b}_{a}(\tau))d{\tau}^2\\
        &=\sideset{^G}{}{\mathop{\textbf{p}_{I}}}(t_{in})+
        \sideset{^G}{}{\mathop{\textbf{v}_{I}}}(t_{in})\Delta{t}
        +\frac{1}{2}\sideset{^G}{}{\mathop{\mathbf{g}}}\Delta{t}^{2}\\
        &\hspace{1cm}+\textbf{C}(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(t_{in})}})
        (\iint_{t_{in}}^{t}\textbf{C}(\sideset{^{I_{in}}}{}{\mathop{\mathbf{q}_{I}(\tau)}})
        \sideset{^I}{}{\mathop{\mathbf{a}_{m}(\tau)}}d{\tau}^2
        -\iint_{t_{in}}^{t}\textbf{C}(\sideset{^{I_{in}}}{}{\mathop{\mathbf{q}_{I}(\tau)}})
        \textbf{b}_{a}(\tau)d{\tau}^2)
    \end{array}
\end{equation}
假设在积分区间内，加速度计bias为常量，则有，
\begin{equation}\label{eqs:imuInG}
    \begin{array}{ll}
        \sideset{^G}{}{\mathop{\textbf{p}_{I}}}(t)
        &=\sideset{^G}{}{\mathop{\textbf{p}_{I}}}(t_{in})+
        \sideset{^G}{}{\mathop{\textbf{v}_{I}}}(t_{in})\Delta{t}
        +\frac{1}{2}\sideset{^G}{}{\mathop{\mathbf{g}}}\Delta{t}^{2}\\
        &\hspace{1cm}+\textbf{C}(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(t_{in})}})
        (\iint_{t_{in}}^{t}\textbf{C}(\sideset{^{I_{in}}}{}{\mathop{\mathbf{q}_{I}(\tau)}})
        \sideset{^I}{}{\mathop{\mathbf{a}_{m}(\tau)}}d{\tau}^2
        -\iint_{t_{in}}^{t}\textbf{C}(\sideset{^{I_{in}}}{}{\mathop{\mathbf{q}_{I}(\tau)}})
        d{\tau}^2\textbf{B})\\
        &=\sideset{^G}{}{\mathop{\textbf{p}_{I}}}(t_{in})+
        \sideset{^G}{}{\mathop{\textbf{v}_{I}}}(t_{in})\Delta{t}
        +\frac{1}{2}\sideset{^G}{}{\mathop{\mathbf{g}}}\Delta{t}^{2}
        +\textbf{C}(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(t_{in})}})
        (\sideset{^{I_{in}}}{}{\mathop{\textbf{S}_{I}(t)}}
        -\sideset{^{I_{in}}}{}{\mathop{{\Gamma}_{I}(t)}}\textbf{B})
    \end{array}
\end{equation}
其中
\begin{equation}
    \sideset{^{I_{in}}}{}{\mathop{\textbf{S}_{I}(t)}}=\iint_{t_{in}}^{t}\textbf{C}(\sideset{^{I_{in}}}{}{\mathop{\mathbf{q}_{I}(\tau)}})
    \sideset{^I}{}{\mathop{\mathbf{a}_{m}(\tau)}}d{\tau}^2
\end{equation}
\begin{equation}
    \sideset{^{I_{in}}}{}{\mathop{{\Gamma}_{I}(t)}}=\iint_{t_{in}}^{t}\textbf{C}(\sideset{^{I_{in}}}{}{\mathop{\mathbf{q}_{I}(\tau)}})
    d{\tau}^2
\end{equation}
且$\sideset{^{I_{in}}}{}{\mathop{\textbf{S}_{I}(t)}}$和$\sideset{^{I_{in}}}{}{\mathop{{\Gamma}_{I}(t)}}$可由加速度计和陀螺仪提供的测量积分得到。

\par
现假设有N个地图点被同时观测到，$\sideset{^G}{}{\mathop{\textbf{p}_{f_i}}},i=1,\dots,N$，表示在第$t$时刻的相机
坐标系下为$\sideset{^{I_t}}{}{\mathop{\textbf{p}_{f_i}}}$，则有，
\begin{equation}\label{eqs:mappointInG1}
    \sideset{^G}{}{\mathop{\textbf{p}_{f_i}}}=\sideset{^G}{}{\mathop{\textbf{p}_I}}(t)
    +\textbf{C}(\sideset{^G}{}{\mathop{\textbf{q}_{I}}}(t_{in}))\textbf{C}(\sideset{^{I_{in}}}{}{\mathop{\textbf{q}_{I}}}(t))
    \sideset{^{I_t}}{}{\mathop{\textbf{p}_{f_i}}}
\end{equation}
若上式中$t=t_{in}$，则有，
\begin{equation}\label{eqs:mappointInG2}
    \sideset{^G}{}{\mathop{\textbf{p}_{f_i}}}=\sideset{^G}{}{\mathop{\textbf{p}_I}}(t_{in})
    +\textbf{C}(\sideset{^G}{}{\mathop{\textbf{q}_{I}}}(t_{in}))
    \sideset{^{I_{in}}}{}{\mathop{\textbf{p}_{f_i}}}
\end{equation}
将（\ref{eqs:imuInG}）和（\ref{eqs:mappointInG2}）带入（\ref{eqs:mappointInG1}），得到，
\begin{equation}
    \begin{array}{ll}
        \sideset{^G}{}{\mathop{\textbf{p}_I}}(t_{in})
        +\textbf{C}(\sideset{^G}{}{\mathop{\textbf{q}_{I}}}(t_{in}))
        \sideset{^{I_{in}}}{}{\mathop{\textbf{p}_{f_i}}}
        &=\sideset{^G}{}{\mathop{\textbf{p}_{I}}}(t_{in})+
        \sideset{^G}{}{\mathop{\textbf{v}_{I}}}(t_{in})\Delta{t}
        +\frac{1}{2}\sideset{^G}{}{\mathop{\mathbf{g}}}\Delta{t}^{2}
        +\textbf{C}(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(t_{in})}})
        (\sideset{^{I_{in}}}{}{\mathop{\textbf{S}_{I}(t)}}
        -\sideset{^{I_{in}}}{}{\mathop{{\Gamma}_{I}(t)}}\textbf{B})\\
        &\hspace{1cm}+\textbf{C}(\sideset{^G}{}{\mathop{\textbf{q}_{I}}}(t_{in}))\textbf{C}(\sideset{^{I_{in}}}{}{\mathop{\textbf{q}_{I}}}(t))
        \sideset{^{I_t}}{}{\mathop{\textbf{p}_{f_i}}}\\
        \Leftrightarrow
        \textbf{C}(\sideset{^G}{}{\mathop{\textbf{q}_{I}}}(t_{in}))
        \sideset{^{I_{in}}}{}{\mathop{\textbf{p}_{f_i}}}
        &=\sideset{^G}{}{\mathop{\textbf{v}_{I}}}(t_{in})\Delta{t}
        +\frac{1}{2}\sideset{^G}{}{\mathop{\mathbf{g}}}\Delta{t}^{2}
        +\textbf{C}(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(t_{in})}})
        (\sideset{^{I_{in}}}{}{\mathop{\textbf{S}_{I}(t)}}
        -\sideset{^{I_{in}}}{}{\mathop{{\Gamma}_{I}(t)}}\textbf{B})\\
        &\hspace{1cm}+\textbf{C}(\sideset{^G}{}{\mathop{\textbf{q}_{I}}}(t_{in}))\textbf{C}(\sideset{^{I_{in}}}{}{\mathop{\textbf{q}_{I}}}(t))
        \sideset{^{I_t}}{}{\mathop{\textbf{p}_{f_i}}}
    \end{array}
\end{equation}
两边同时乘以$\textbf{C}^T(\sideset{^G}{}{\mathop{\textbf{q}_{I}}}(t_{in}))$，得到，
\begin{equation}\label{eqs:geometryRelation1}
    \begin{array}{ll}
        &\sideset{^{I_{in}}}{}{\mathop{\textbf{p}_{f_i}}}
        =\textbf{C}^T(\sideset{^G}{}{\mathop{\textbf{q}_{I}}}(t_{in}))
        (\sideset{^G}{}{\mathop{\textbf{v}_{I}}}(t_{in})\Delta{t}
        +\frac{1}{2}\sideset{^G}{}{\mathop{\mathbf{g}}}\Delta{t}^{2}
        +\textbf{C}(\sideset{^G}{}{\mathop{\mathbf{q}_{I}(t_{in})}})
        (\sideset{^{I_{in}}}{}{\mathop{\textbf{S}_{I}(t)}}
        -\sideset{^{I_{in}}}{}{\mathop{{\Gamma}_{I}(t)}}\textbf{B}))
        +\textbf{C}(\sideset{^{I_{in}}}{}{\mathop{\textbf{q}_{I}}}(t))
        \sideset{^{I_t}}{}{\mathop{\textbf{p}_{f_i}}}\\
        &\Leftrightarrow
        \textbf{C}(\sideset{^{I_{in}}}{}{\mathop{\textbf{q}_{I}}}(t))
        \sideset{^{I_t}}{}{\mathop{\textbf{p}_{f_i}}}
        =\sideset{^{I_{in}}}{}{\mathop{\textbf{p}_{f_i}}}
        -\sideset{^{I_{in}}}{}{\mathop{\textbf{v}_I}}\Delta{t}
        -\frac{1}{2}\sideset{^{I_{in}}}{}{\mathop{\mathbf{g}}}\Delta{t}^{2}
        -\sideset{^{I_{in}}}{}{\mathop{\textbf{S}_{I}(t)}}
        +\sideset{^{I_{in}}}{}{\mathop{{\Gamma}_{I}(t)}}\textbf{B}
    \end{array}
\end{equation}
其中
\begin{equation}
    \sideset{^{I_{in}}}{}{\mathop{\textbf{v}_I}}
    =\textbf{C}^T(\sideset{^G}{}{\mathop{\textbf{q}_{I}}}(t_{in}))
    \sideset{^G}{}{\mathop{\textbf{v}_{I}}}(t_{in})
\end{equation}
\begin{equation}
    \sideset{^{I_{in}}}{}{\mathop{\mathbf{g}}}
    =\textbf{C}^T(\sideset{^G}{}{\mathop{\textbf{q}_{I}}}(t_{in}))
    \sideset{^G}{}{\mathop{\mathbf{g}}}
\end{equation}

\par
假设在时间段$t_{in},t_{fin}$内，共有$M$帧图像：$t_1=t_{in}<t_2<\dots<t_M=t_{fin}$，且$N$个地图点
均被这M帧图像观测到。为简化书写，利用如下简写：
\begin{equation}
    \begin{array}{ll}
        &\textbf{P}_j^i\triangleq\textbf{C}(\sideset{^{I_{in}}}{}{\mathop{\textbf{q}_{I}}}(t_j))
        \sideset{^{I_{t_j}}}{}{\mathop{\textbf{p}_{f_i}}}\\
        &\textbf{P}^i \triangleq \sideset{^{I_{in}}}{}{\mathop{\textbf{p}_{f_i}}}\\
        &\textbf{V} \triangleq \sideset{^{I_{in}}}{}{\mathop{\textbf{v}_I}}\\
        &\textbf{G} \triangleq \sideset{^{I_{in}}}{}{\mathop{\mathbf{g}}}\\
        &\Gamma_j \triangleq \sideset{^{I_{in}}}{}{\mathop{{\Gamma}_{I}(t_j)}}\\
        &\textbf{S}_j \triangleq \sideset{^{I_{in}}}{}{\mathop{\textbf{S}_{I}(t_j)}}
    \end{array}
\end{equation}
其中$i=1,2,\dots,N;\ \ j=1,2,\dots,M$。另外，用$\mathbf{\mu}_j^i$表示$\textbf{P}_j^i$的单位向量，
则有$\textbf{P}_j^i=\lambda_j^i\mathbf{\mu}_j^i$。不失一般性，可令$t_{in}=0$，则有$\Delta{t}=t$。
几何关系式（\ref{eqs:geometryRelation1}）在每个图像帧时刻$t_j$，可表示为
\begin{equation}\label{eqs:geometryRelation2}
    \textbf{P}^i-\textbf{V}t_j-\frac{1}{2}\textbf{G}t_j^2+\Gamma_j\textbf{B}
    -\lambda_j^i\mathbf{\mu}_j^i=\textbf{S}_j
\end{equation}
另外当$j=1$时，$t_j=t_1=t_{in}=0$，则有$\textbf{P}^i=\textbf{P}^i_1=\lambda_1^i\mathbf{\mu}_1^i$。
几何关系（\ref{eqs:geometryRelation2}）可进一步表示为，
\begin{equation}\label{eqs:geometryRelation3}
    -\textbf{V}t_j-\frac{1}{2}\textbf{G}t_j^2+\Gamma_j\textbf{B}+\lambda_1^i\mathbf{\mu}_1^i
    -\lambda_j^i\mathbf{\mu}_j^i=\textbf{S}_j
\end{equation}
对于第$t_1$帧和第$t_j$帧，第1个地图点和第$i$个地图点，有如下几何关系：
\begin{equation}\label{eqs:geometryRelation4}
    \lambda_1^1\mathbf{\mu}_1^1-\lambda_j^1\mathbf{\mu}_j^1
    =\lambda_1^i\mathbf{\mu}_1^i-\lambda_j^i\mathbf{\mu}_j^i
\end{equation}
综合几何关系（\ref{eqs:geometryRelation3}）和（\ref{eqs:geometryRelation4}），可最终得到如下关系式子，
\begin{equation}\label{eqs:geometryRelation5}
    \left\{\begin{array}{c}
        -\textbf{V}t_j-\frac{1}{2}\textbf{G}t_j^2+\Gamma_j\textbf{B}+\lambda_1^1\mathbf{\mu}_1^1
        -\lambda_j^1\mathbf{\mu}_j^1=\textbf{S}_j\\
        \lambda_1^1\mathbf{\mu}_1^1-\lambda_j^1\mathbf{\mu}_j^1
        -\lambda_1^i\mathbf{\mu}_1^i+\lambda_j^i\mathbf{\mu}_j^i=\textbf{0}_3
    \end{array}\right.
\end{equation}
其中$j=2,3,\dots,M;\ \ i=2,3,\dots,N$。
分析VI-SLAM系统初始化的闭式可解性，亦即分析在几何关系（\ref{eqs:geometryRelation5}）下，
变量$\textbf{P}^i_j,\textbf{V},\textbf{G},\textbf{B}$的可解性。其中（\ref{eqs:geometryRelation5}）
可提供$3*(M-1)*N$个方程，未知变量有$M*N+6$维（不考虑bias）或$M*N+9$维（只考虑加速度计bias）。
\par
定义如下变量和矩阵：
考虑加速度计bias未知变量，
\begin{equation}
    \textbf{X}\triangleq\left[\textbf{G}^T,\textbf{V}^T,\textbf{B}^T,\lambda_1^1,\dots,\lambda_1^N,
    \dots,\lambda_M^1,\dots,\lambda_M^N\right]^T
\end{equation}
不考虑bias未知变量，
\begin{equation}
    \textbf{X}\triangleq\left[\textbf{G}^T,\textbf{V}^T,\lambda_1^1,\dots,\lambda_1^N,
    \dots,\lambda_M^1,\dots,\lambda_M^N\right]^T
\end{equation}
IMU测量相关积分变量，
\begin{equation}
    \textbf{S}\triangleq \left[\textbf{S}_2^T,\textbf{0}_{1\times3},\dots,\textbf{0}_{1\times 3},
    \textbf{S}_3^T,\textbf{0}_{1\times3},\dots,\textbf{0}_{1\times 3},
    \textbf{S}_M^T,\textbf{0}_{1\times3},\dots,\textbf{0}_{1\times 3}\right]^T
\end{equation}
几何关系矩阵，
\begin{equation}
    \Xi=\left[\begin{array}{cccccccccccccc}
        \textbf{T}_2&\textbf{K}_2&\Gamma_2&\mathbf{\mu}_1^1&\textbf{0}_{3\times 1}&\dots&\textbf{0}_{3\times 1}&
        -\mathbf{\mu}_2^1&\textbf{0}_{3\times 1}&\dots&\textbf{0}_{3\times 1}&\dots&\dots&\textbf{0}_{3\times 1}\\
        \textbf{0}_{3\times 3}&\textbf{0}_{3\times 3}&\textbf{0}_{3\times 3}&\mathbf{\mu}_1^1&-\mathbf{\mu}_1^2&\dots&\textbf{0}_{3\times 1}&
        -\mathbf{\mu}_2^1&\mathbf{\mu}_2^2&\dots&\textbf{0}_{3\times 1}&\dots&\dots&\textbf{0}_{3\times 1}\\
        \dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots\\
        \textbf{0}_{3\times 3}&\textbf{0}_{3\times 3}&\textbf{0}_{3\times 3}&\mathbf{\mu}_1^1&\textbf{0}_{3\times 1}&\dots&-\mathbf{\mu}_1^N&
        -\mathbf{\mu}_2^1&\textbf{0}_{3\times 1}&\dots&\mathbf{\mu}_2^N&\dots&\dots&\textbf{0}_{3\times 1}\\
        \dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots\\
        \dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots\\
        \textbf{T}_M&\textbf{K}_M&\Gamma_M&\mathbf{\mu}_1^1&\textbf{0}_{3\times 1}&\dots&\dots&
        \dots&\dots&\dots&\textbf{0}_{3\times 1}&-\mathbf{\mu}_M^1&\dots&\textbf{0}_{3\times 1}\\
        \textbf{0}_{3\times 3}&\textbf{0}_{3\times 3}&\textbf{0}_{3\times 3}&\mathbf{\mu}_1^1&-\mathbf{\mu}_1^2&\dots&\dots&
        \dots&\dots&\dots&\textbf{0}_{3\times 1}&-\mathbf{\mu}_M^1&\mathbf{\mu}_M^2&\textbf{0}_{3\times 1}\\
        \dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots&\dots\\
        \textbf{0}_{3\times 3}&\textbf{0}_{3\times 3}&\textbf{0}_{3\times 3}&\mathbf{\mu}_1^1&\textbf{0}_{3\times 1}&\dots&-\mathbf{\mu}_1^N&
        \textbf{0}_{3\times 1}&\dots&\dots&\textbf{0}_{3\times 1}&-\mathbf{\mu}_M^1&\dots&\mathbf{\mu}_M^N
    \end{array}\right]
\end{equation}
其中$\textbf{T}_j\triangleq -\frac{t_j^2}{2}\textbf{I}_3$和$\textbf{K}_j\triangleq -t_j\textbf{I}_3$。

\par
根据以上定义，对于M帧图像和N个地图点的几何关系式（\ref{eqs:geometryRelation5}）可表示为
\begin{equation}\label{eqs:geometryRelation6}
    \Xi\textbf{X}=\textbf{S}
\end{equation}
假设重力的大小已知，即$|\textbf{G}|=g$，则对方程组（\ref{eqs:geometryRelation6}）添加如下约束，
\begin{equation}\label{eqs:geometryRelation7}
    |\Pi\textbf{X}|^2=g^2
\end{equation}
其中$\Pi\triangleq \left[\textbf{I}_3,\textbf{0}_3,\dots,\textbf{0}_3\right]$。

\par
至此，VI-SLAM系统初始化的闭式可解性分析，将基于方程组（\ref{eqs:geometryRelation6}）和（\ref{eqs:geometryRelation7}）。
通过分析矩阵$\Xi$的零空间$\mathcal{N}(\Xi)$，可得到变量$\textbf{X}$的可解情况。

\subsection{基本原理}
关于VI-SLAM系统解的个数，有如下结论：
\par
\textbf{Theorem1：} (a)当矩阵$\Xi$的零空间$\mathcal{N}(\Xi)$为空时，有且仅有1个解；
(b)当零空间$dim(\mathcal{N}(\Xi))=1$，且对于任意$\textbf{n}\in\mathcal{N}(\Xi),\ \ |\Pi\textbf{n}|\not=0$时，
有2个解；(c)其他情况，有无数解。
\par
证明如下：$(\romannumeral1)$对于结论(a)，显然地利用高斯消元法解方程组，可得到唯一解；$(\romannumeral2)$当$dim(\mathcal{N}(\Xi))=1$时，
线性方程组（\ref{eqs:geometryRelation6}）有解：$\textbf{X}(\gamma)=\Xi^{-1}\textbf{S}+\gamma\textbf{n}$（左右乘以$\Xi$可验证），
其中$\Xi^{-1}$为$\Xi$的伪逆，$\textbf{n}$为零空间$\mathcal{N}(\Xi)$的列向量，$\gamma\in\mathbb{R}$为一个未知标量。
$\gamma$可由式子（\ref{eqs:geometryRelation7}）解得：当$|\Pi\textbf{n}|\not=0$时，$|\Pi\textbf{X}(\gamma)|^2=g^2$
是关于$\gamma$的二次多项式，因此有两个解$\gamma_1$和$\gamma_2$，对应有两个解$\textbf{X}$，$\textbf{X}_1\triangleq \textbf{X}(\gamma_1)$
和$\textbf{X}_2\triangleq \textbf{X}(\gamma_2)$；当$|\Pi\textbf{n}|=0$时，$|\Pi\textbf{X}(\gamma)|^2=g^2$与$\gamma$不相关，因此有无数解。

\par
结合\textbf{Theorem1}可通过分析矩阵$\Xi$的零空间$\mathcal{N}(\Xi)$，得到VI-SLAM系统的可解的情况。
由于矩阵的每一列乘以一个非零的标量常数，不改变矩阵零空间，为便于分析，将矩阵$\Xi$做如下变形，
亦即每一列乘以对应的$\lambda_j^i$还原为$\textbf{P}_j^i=\lambda_j^i\mathbf{\mu}_j^i$，得到
\begin{equation}
    \Xi'\triangleq \left[\begin{array}{cccccc}
        \mathcal{M}_2&\mathcal{P}_1&\mathcal{P}_2&\textbf{0}_{3N\times N}&\dots&\textbf{0}_{3N\times N}\\
        \mathcal{M}_3&\mathcal{P}_1&\textbf{0}_{3N\times N}&\mathcal{P}_3&\dots&\textbf{0}_{3N\times N}\\
        \dots&\dots&\dots&\dots&\dots&\dots\\
        \mathcal{M}_M&\mathcal{P}_1&\textbf{0}_{3N\times N}&\textbf{0}_{3N\times N}&\dots&\mathcal{P}_M
    \end{array}\right]
\end{equation}
其中
\begin{equation}
    \mathcal{M}_j\triangleq \left[\begin{array}{ccc}
        \textbf{T}_j&\textbf{K}_j&\Gamma_j\\
        \textbf{0}_{3\times 3}&\textbf{0}_{3\times 3}&\textbf{0}_{3\times 3}\\
        \dots&\dots&\dots\\
        \textbf{0}_{3\times 3}&\textbf{0}_{3\times 3}&\textbf{0}_{3\times 3}
    \end{array}\right]
\end{equation}
\begin{equation}
    \mathcal{P}_j\triangleq \left[\begin{array}{ccccc}
        \textbf{P}_j^1&\textbf{0}_{3\times 1}&\textbf{0}_{3\times 1}&\dots&\textbf{0}_{3\times 1}\\
        \textbf{P}_j^1&\textbf{P}_j^2&\textbf{0}_{3\times 1}&\dots&\textbf{0}_{3\times 1}\\
        \textbf{P}_j^1&\textbf{0}_{3\times 1}&\textbf{P}_j^3&\dots&\textbf{0}_{3\times 1}\\
        \dots&\dots&\dots&\dots&\dots\\
        \textbf{P}_j^1&\textbf{0}_{3\times 1}&\dots&\textbf{0}_{3\times 1}&\textbf{P}_j^N
    \end{array}\right]
\end{equation}
由式子（\ref{eqs:geometryRelation4}）可知$\textbf{P}_j^i-\textbf{P}_1^i,i=1,2,\dots,N$独立于$i$，
因此令$\mathcal{X}_j\triangleq \textbf{P}_j^i-\textbf{P}_1^i$表征IMU系的运动状态。
为保证矩阵$\Xi'$的每一列不为零，做如下假设：
\par
\textbf{Assumption1:}对于任意$i=1,2,\dots,N,\ \ j=2,\dots,M$，有$\textbf{P}_j^i\not=\textbf{0}_{3\times 1}$。

\par
接下来，基于上述结论，通过分析矩阵$\Xi'$的零空间，进而分析考虑bias和不考虑bias时，VI-SLAM系统的可解性。

\section{可解性分析：Unbiased Case}
假设向量$\textbf{n}\in\mathcal{N}(\Xi')$，
\begin{equation}
    \textbf{n}\triangleq \left[\mathbf{\alpha}^T,\mathbf{\nu}^T,n_1^1,\dots,n_1^N,
    n_2^1,\dots,n_2^N,\dots,n_M^1,\dots,n_M^N\right]^T
\end{equation}
且有
\begin{equation}\label{eqs:geometryRelation8}
    \Xi'\textbf{n}=\textbf{0}_{3(M-1)*N\times 1}
\end{equation}
将上式展开得到
\begin{equation}\label{eqs:geometryRelation8_1}
    -\frac{1}{2}\mathbf{\alpha}t_j^2-t_j\mathbf{\nu}+(n_1^1+n_j^1)\textbf{P}_1^1+n_j^1\mathcal{X}_j=\textbf{0}_{3\times 1}
\end{equation}
\begin{equation}\label{eqs:geometryRelation8_2}
    (n_1^1+n_j^1)\textbf{P}_1^1+(n_1^i+n_j^i)\textbf{P}_1^i+(n_j^1+n_j^i)\mathcal{X}_j=\textbf{0}_{3\times 1}
\end{equation}

下面首先分析2D下共面和共线特殊情况，然后再分析3D下各种图像帧数和地图点数量的可解情况。
\subsection{Planar Case}
假设所有地图点和相机运动轨迹处在同一平面上，亦即$\textbf{P}_j^i,i=1,\dots,N,j=2,\dots,M$在同一平面上。
则矩阵$\Xi'$中所有$\textbf{P}_j^i$的某一维可以高斯消元为零：假设所有地图点和相机运动轨迹所在的同一平面
方程为$Ax+By+Cz+D=0$则$x,y,z$的其中之一可由另外两个变量线性表示。现假设在共面情况下，所有$\textbf{P}_j^i$
的第三维为零。注意变量$\mathbf{\alpha}$和$\mathbf{\nu}$的第三维不为零，因为公共平面可能为三维空间中的斜平面。
为方便分析，将系统（\ref{eqs:geometryRelation8}）分为两部分：第一部分为（\ref{eqs:geometryRelation8_1}）
和（\ref{eqs:geometryRelation8_2}）的第一行和第二行组成的矩阵$\Xi_1^{plane}$，其维度为{\color{red}{$2(M-1)N\times (MN+4)$}}；
第二部分为（\ref{eqs:geometryRelation8_1}）的第三行组成的矩阵$\Xi_2^{plane}$，其只包含$\mathbf{\alpha}$和
$\mathbf{\nu}$的第三维，维度为{\color{red}{$(M-1)\times 2$}}。
\par
根据\textbf{Theorem1}，
\par
(1)当$M\leqslant 2$时，$dim(\mathcal{N}(\Xi_1^{plane}))\geqslant 4$；保证系统具有
有限个解的先决条件为$M\geqslant 3$。
\par
(2)当$M\geqslant 3$时，$dim(\mathcal{N}(\Xi_2^{plane}))=0$；
\par
(3)当$M=3$时，矩阵$\Xi_1^{plane}$的维度为$4N\times (3N+4)$；因此为了使$dim(\mathcal{N}(\Xi_1^{plane}))\leqslant 1$,
至少需要保证$N\geqslant 3$；
\par
(4)当$M=4$时，矩阵$\Xi_1^{plane}$的维度为$6N\times (4N+4)$；因此为了使$dim(\mathcal{N}(\Xi_1^{plane}))\leqslant 1$,
至少需要保证$N\geqslant 2$；
\par
(5)当$M\geqslant 5$时，$N$无要求。

\subsection{Linear Case}
假设所有地图点和相机运动轨迹共线，亦即$\textbf{P}_j^i,i=1,\dots,N,j=2,\dots,M$在同一条线上。则矩阵$\Xi'$中
所有$\textbf{P}_j^i$的某两维可以高斯消元为零：根据空间直线方程，$\textbf{P}_j^i$任意一维可线性表示另外两维。
现假设在共线情况下，所有$\textbf{P}_j^i$的第二、三维为零。同样的，为方便分析，
将系统（\ref{eqs:geometryRelation8}）分为两部分：第一部分为（\ref{eqs:geometryRelation8_1}）
和（\ref{eqs:geometryRelation8_2}）的第一行组成的矩阵$\Xi_1^{line}$，其维度为{\color{red}{$(M-1)N\times (MN+2)$}}；
第二部分为（\ref{eqs:geometryRelation8_1}）的第二、三行组成的矩阵$\Xi_2^{line}$，其只包含$\mathbf{\alpha}$和
$\mathbf{\nu}$的第二、三维，维度为{\color{red}{$2(M-1)\times 4$}}。显然地，$dim(\mathcal{N}(\Xi_1^{line})>2$，
根据\textbf{Theorem1}，系统在任何条件下，均有无数解。
\par
\ 
\par
接下来，讨论一般3D情况下的系统可解性。首先给出性质：
\par
\textbf{Property1: } (a)当$M\leqslant 2$时，$dim(\mathcal{N}(\Xi'))\geqslant 3$；
(b)当$M=3$时，$dim(\mathcal{N}(\Xi'))\geqslant 1$；
(c)当$M\geqslant 4$，且相机匀加速运动时，$dim(\mathcal{N}(\Xi'))\geqslant 1$。
\par
证明如下：首先定义一个子系统，
\begin{equation}
    -\frac{1}{2}\mathbf{\alpha}t_j^2-t_j\mathbf{\nu}=-\mathcal{X}_j, j=2,\dots,M
\end{equation}
且由其构成的方程组矩阵为$\Xi''$。显然的，$dim(\mathcal{N}(\Xi''))\leqslant dim(\mathcal{N}(\Xi'))$。
假如变量$\left[\textbf{n}_\mathbf{\alpha}^T,\textbf{n}_\mathbf{\nu}^T\right]^T\in\mathcal{N}(\Xi'')$，
则由$\mathbf{\alpha}=\textbf{n}_{\mathbf{\alpha}},\mathbf{\nu}=\textbf{n}_{\mathbf{\nu}},n_j^i=0, \forall i,j$
组成的向量$\textbf{n}\in \mathcal{N}(\Xi')$。


\subsection{图像帧数小于等于2}

\subsection{图像帧数等于3}

\subsection{图像帧数大于等于4}

\subsection{Constant Acceleration}

\section{可解性分析：Biased Case}
\subsection{图像帧数小于等于3}

\subsection{图像帧数等于4}

\subsection{图像帧数大于等于5}

\section{Gyroscope Bias估计}

\section{Modified MK闭式解}


\begin{thebibliography}{99}  
    \bibitem{zhihu}https://www.zhihu.com/question/22983179
    \bibitem{Meyer2000}Meyer CD (2000) Matrix Analysis and Applied Linear Algebra. Philadelphia, PA: SIAM.
    \bibitem{consistency} Hesch J A, Kottas D G, Bowman S L, et al. Camera-IMU-based localization: Observability analysis and consistency improvement[J]. The International Journal of Robotics Research, 2014, 33(1): 182-201.
    \bibitem{rvio} Huai Z, Huang G. Robocentric visual-inertial odometry[C]//2018 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS). IEEE, 2018: 6319-6326.
\end{thebibliography}



\end{document}

